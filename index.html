<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kati Check - Philippine Allergen & Nutrition Checker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (All CSS styles remain exactly the same) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Color Scheme */
            --primary: #e74c3c;
            --primary-light: #fd7e7e;
            --primary-dark: #c0392b;
            --secondary: #27ae60;
            --accent: #f39c12;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light-gray: #ecf0f1;
            --safe: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            
            /* Nutrition Colors - KEEPING FOR FILTERS */
            --nutrition-calories: #3498db;
            --nutrition-protein: #9b59b6;
            --nutrition-carbs: #2ecc71;
            --nutrition-fat: #e67e22;
            --nutrition-fiber: #1abc9c;
            --nutrition-sodium: #95a5a6;
            --nutrition-sugar: #e74c3c;
            
            /* Allergen Colors */
            --allergen-gluten: #8e44ad;
            --allergen-crustacean: #d35400;
            --allergen-egg: #f39c12;
            --allergen-fish: #3498db;
            --allergen-peanut: #964b00;
            --allergen-soy: #27ae60;
            --allergen-milk: #f8c471;
            --allergen-nuts: #8b4513;
            --allergen-celery: #7dcea0;
            --allergen-mustard: #f4d03f;
            --allergen-sesame: #f0b27a;
            --allergen-sulfite: #7f8c8d;
            --allergen-lupin: #a569bd;
            --allergen-mollusc: #16a085;
        }

        body {
            background: #ffffff;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 800;
        }

        .logo-text .tagline {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 500;
        }

        .company-login-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .company-login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        /* Main Content */
        main {
            padding: 30px 0 50px;
        }

        .section-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--dark);
            position: relative;
            padding-bottom: 15px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .hidden {
            display: none !important;
        }

        /* Allergen Selection */
        .allergen-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        @media (max-width: 768px) {
            .allergen-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .allergen-grid {
                grid-template-columns: 1fr;
            }
        }

        .allergen-item {
            background: var(--light);
            border-radius: 12px;
            padding: 25px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 140px;
            position: relative;
            overflow: hidden;
        }

        .allergen-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .allergen-item.selected {
            background: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .allergen-item.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }

        .allergen-icon {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        .allergen-item.selected .allergen-icon {
            background: var(--allergen-gluten);
            color: white;
            transform: scale(1.1);
        }

        .allergen-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--dark);
            line-height: 1.3;
            text-align: center;
            width: 100%;
        }

        /* Allergen-specific colors - ALL 25 ALLERGENS INCLUDED */
        .allergen-item[data-name="Gluten"] { border-color: var(--allergen-gluten); }
        .allergen-item[data-name="Gluten"].selected .allergen-icon { background: var(--allergen-gluten); }
        .allergen-item[data-name="Gluten"].selected::before { background: var(--allergen-gluten); }

        .allergen-item[data-name="Shrimp"] { border-color: var(--allergen-crustacean); }
        .allergen-item[data-name="Shrimp"].selected .allergen-icon { background: var(--allergen-crustacean); }
        .allergen-item[data-name="Shrimp"].selected::before { background: var(--allergen-crustacean); }

        .allergen-item[data-name="Crab"] { border-color: var(--allergen-crustacean); }
        .allergen-item[data-name="Crab"].selected .allergen-icon { background: var(--allergen-crustacean); }
        .allergen-item[data-name="Crab"].selected::before { background: var(--allergen-crustacean); }

        .allergen-item[data-name="Lobster"] { border-color: var(--allergen-crustacean); }
        .allergen-item[data-name="Lobster"].selected .allergen-icon { background: var(--allergen-crustacean); }
        .allergen-item[data-name="Lobster"].selected::before { background: var(--allergen-crustacean); }

        .allergen-item[data-name="Eggs"] { border-color: var(--allergen-egg); }
        .allergen-item[data-name="Eggs"].selected .allergen-icon { background: var(--allergen-egg); }
        .allergen-item[data-name="Eggs"].selected::before { background: var(--allergen-egg); }

        .allergen-item[data-name="Fish"] { border-color: var(--allergen-fish); }
        .allergen-item[data-name="Fish"].selected .allergen-icon { background: var(--allergen-fish); }
        .allergen-item[data-name="Fish"].selected::before { background: var(--allergen-fish); }

        .allergen-item[data-name="Peanuts"] { border-color: var(--allergen-peanut); }
        .allergen-item[data-name="Peanuts"].selected .allergen-icon { background: var(--allergen-peanut); }
        .allergen-item[data-name="Peanuts"].selected::before { background: var(--allergen-peanut); }

        .allergen-item[data-name="Soy"] { border-color: var(--allergen-soy); }
        .allergen-item[data-name="Soy"].selected .allergen-icon { background: var(--allergen-soy); }
        .allergen-item[data-name="Soy"].selected::before { background: var(--allergen-soy); }

        .allergen-item[data-name="Milk"] { border-color: var(--allergen-milk); }
        .allergen-item[data-name="Milk"].selected .allergen-icon { background: var(--allergen-milk); color: var(--dark); }
        .allergen-item[data-name="Milk"].selected::before { background: var(--allergen-milk); }

        .allergen-item[data-name="Tree Nuts"] { border-color: var(--allergen-nuts); }
        .allergen-item[data-name="Tree Nuts"].selected .allergen-icon { background: var(--allergen-nuts); }
        .allergen-item[data-name="Tree Nuts"].selected::before { background: var(--allergen-nuts); }

        .allergen-item[data-name="Celery"] { border-color: var(--allergen-celery); }
        .allergen-item[data-name="Celery"].selected .allergen-icon { background: var(--allergen-celery); }
        .allergen-item[data-name="Celery"].selected::before { background: var(--allergen-celery); }

        .allergen-item[data-name="Mustard"] { border-color: var(--allergen-mustard); }
        .allergen-item[data-name="Mustard"].selected .allergen-icon { background: var(--allergen-mustard); }
        .allergen-item[data-name="Mustard"].selected::before { background: var(--allergen-mustard); }

        .allergen-item[data-name="Sesame"] { border-color: var(--allergen-sesame); }
        .allergen-item[data-name="Sesame"].selected .allergen-icon { background: var(--allergen-sesame); }
        .allergen-item[data-name="Sesame"].selected::before { background: var(--allergen-sesame); }

        .allergen-item[data-name="Sulfites"] { border-color: var(--allergen-sulfite); }
        .allergen-item[data-name="Sulfites"].selected .allergen-icon { background: var(--allergen-sulfite); }
        .allergen-item[data-name="Sulfites"].selected::before { background: var(--allergen-sulfite); }

        .allergen-item[data-name="Lupin"] { border-color: var(--allergen-lupin); }
        .allergen-item[data-name="Lupin"].selected .allergen-icon { background: var(--allergen-lupin); }
        .allergen-item[data-name="Lupin"].selected::before { background: var(--allergen-lupin); }

        .allergen-item[data-name="Molluscs"] { border-color: var(--allergen-mollusc); }
        .allergen-item[data-name="Molluscs"].selected .allergen-icon { background: var(--allergen-mollusc); }
        .allergen-item[data-name="Molluscs"].selected::before { background: var(--allergen-mollusc); }

        .allergen-item[data-name="Crustaceans"] { border-color: var(--allergen-crustacean); }
        .allergen-item[data-name="Crustaceans"].selected .allergen-icon { background: var(--allergen-crustacean); }
        .allergen-item[data-name="Crustaceans"].selected::before { background: var(--allergen-crustacean); }

        .allergen-item[data-name="Shellfish"] { border-color: var(--allergen-crustacean); }
        .allergen-item[data-name="Shellfish"].selected .allergen-icon { background: var(--allergen-crustacean); }
        .allergen-item[data-name="Shellfish"].selected::before { background: var(--allergen-crustacean); }

        .allergen-item[data-name="Wheat"] { border-color: var(--allergen-gluten); }
        .allergen-item[data-name="Wheat"].selected .allergen-icon { background: var(--allergen-gluten); }
        .allergen-item[data-name="Wheat"].selected::before { background: var(--allergen-gluten); }

        .allergen-item[data-name="Barley"] { border-color: var(--allergen-gluten); }
        .allergen-item[data-name="Barley"].selected .allergen-icon { background: var(--allergen-gluten); }
        .allergen-item[data-name="Barley"].selected::before { background: var(--allergen-gluten); }

        .allergen-item[data-name="Rye"] { border-color: var(--allergen-gluten); }
        .allergen-item[data-name="Rye"].selected .allergen-icon { background: var(--allergen-gluten); }
        .allergen-item[data-name="Rye"].selected::before { background: var(--allergen-gluten); }

        .allergen-item[data-name="Oats"] { border-color: var(--allergen-gluten); }
        .allergen-item[data-name="Oats"].selected .allergen-icon { background: var(--allergen-gluten); }
        .allergen-item[data-name="Oats"].selected::before { background: var(--allergen-gluten); }

        .allergen-item[data-name="MSG"] { border-color: var(--allergen-sulfite); }
        .allergen-item[data-name="MSG"].selected .allergen-icon { background: var(--allergen-sulfite); }
        .allergen-item[data-name="MSG"].selected::before { background: var(--allergen-sulfite); }

        .allergen-item[data-name="Peanut Oil"] { border-color: var(--allergen-peanut); }
        .allergen-item[data-name="Peanut Oil"].selected .allergen-icon { background: var(--allergen-peanut); }
        .allergen-item[data-name="Peanut Oil"].selected::before { background: var(--allergen-peanut); }

        .allergen-item[data-name="Soybean"] { border-color: var(--allergen-soy); }
        .allergen-item[data-name="Soybean"].selected .allergen-icon { background: var(--allergen-soy); }
        .allergen-item[data-name="Soybean"].selected::before { background: var(--allergen-soy); }

        /* Restaurant Selection */
        .restaurant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .restaurant-item {
            background: var(--light);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .restaurant-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .restaurant-item.selected {
            background: white;
            border-color: var(--secondary);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.15);
        }

        .restaurant-item.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--secondary);
        }

        .restaurant-icon {
            width: 45px;
            height: 45px;
            background: var(--light-gray);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        .restaurant-item.selected .restaurant-icon {
            background: var(--secondary);
            color: white;
            transform: scale(1.1);
        }

        .restaurant-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--dark);
            flex: 1;
        }

        /* Nutrition Filters - KEEPING THESE */
        .nutrition-filters {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .filter-group {
            margin-bottom: 25px;
        }

        .filter-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-label i {
            color: var(--nutrition-calories);
        }

        .filter-range {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: var(--light-gray);
            border-radius: 4px;
            outline: none;
        }

        .filter-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Allergen Selection in Menu Item Form */
        .allergen-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
        }

        .allergen-select-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .allergen-select-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .allergen-select-item.selected {
            border-color: var(--primary);
            background-color: rgba(231, 76, 60, 0.1);
        }

        .allergen-select-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .allergen-select-name {
            font-size: 0.85rem;
            text-align: center;
            font-weight: 600;
        }

        /* Search Button */
        .search-button-container {
            text-align: center;
            margin: 40px 0;
        }

        .search-button {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .search-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(231, 76, 60, 0.4);
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }

        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-count {
            background: var(--light);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            color: var(--dark);
        }

        .clear-search {
            background: var(--light);
            border: 2px solid var(--light-gray);
            color: var(--gray);
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .clear-search:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .result-item {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-left: 8px solid var(--safe);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .result-item:hover::before {
            opacity: 1;
        }

        .result-item.unsafe {
            border-left-color: var(--danger);
        }

        .result-item.may-contain {
            border-left-color: var(--warning);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .food-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .restaurant-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--gray);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .restaurant-info i {
            color: var(--primary);
        }

        .food-description {
            color: var(--dark);
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .allergen-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .allergen-tag {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .allergen-tag.safe {
            background: rgba(46, 204, 113, 0.1);
            color: var(--safe);
            border: 2px solid rgba(46, 204, 113, 0.2);
        }

        .allergen-tag.contains {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 2px solid rgba(231, 76, 60, 0.2);
        }

        .allergen-tag.may-contain {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border: 2px solid rgba(243, 156, 18, 0.2);
        }

        /* Forms */
        .form-group {
            margin-bottom: 30px;
        }

        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-input {
            width: 100%;
            padding: 18px;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .auth-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .auth-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }

        .back-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: var(--primary);
            background: var(--light);
            border: 2px solid var(--light-gray);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 30px;
            padding: 18px;
            width: 100%;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            background: var(--light);
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 30px;
            border: 2px solid var(--light-gray);
        }

        .auth-tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        /* Company Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 2px solid var(--light-gray);
            flex-wrap: wrap;
            gap: 20px;
        }

        .company-info h2 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .company-info p {
            color: var(--gray);
            font-size: 1rem;
        }

        .dashboard-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .logout-btn {
            background: var(--light);
            border: 2px solid var(--light-gray);
            color: var(--danger);
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-2px);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-top: 5px solid var(--primary);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            color: white;
            font-size: 2rem;
        }

        .stat-number {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .dashboard-section {
            margin-bottom: 40px;
        }

        .dashboard-section-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .add-button {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .add-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .dashboard-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .list-item {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            transition: all 0.3s ease;
            border-left: 5px solid var(--primary);
        }

        .list-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .list-item-info h4 {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .list-item-info p {
            color: var(--gray);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .list-item-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            min-width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .edit-btn {
            background: rgba(52, 152, 219, 0.1);
            color: var(--nutrition-calories);
        }

        .delete-btn {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .nutrition-btn {
            background: rgba(46, 204, 113, 0.1);
            color: var(--nutrition-carbs);
        }

        .view-btn {
            background: rgba(155, 89, 182, 0.1);
            color: var(--nutrition-protein);
        }

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 50px 0 30px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: var(--primary-light);
            font-size: 1.4rem;
            margin-bottom: 25px;
            font-weight: 700;
            position: relative;
            padding-bottom: 15px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            border-radius: 2px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            color: #bbb;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .footer-brand .logo-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
        }

        .footer-brand-text h3 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.6rem;
        }

        .footer-brand-text p {
            color: #bbb;
            font-size: 0.95rem;
        }

        .powered-by {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid #34495e;
            color: #bbb;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .powered-by strong {
            color: var(--primary-light);
            font-weight: 700;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            border-left: 5px solid var(--safe);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--safe);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast i {
            font-size: 1.8rem;
        }

        .toast.success i { color: var(--safe); }
        .toast.error i { color: var(--danger); }
        .toast.warning i { color: var(--warning); }

        .toast-content h4 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .toast-content p {
            font-size: 1rem;
            color: var(--gray);
        }

        /* Loading Spinner */
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--light-gray);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(30px) scale(0.95);
            transition: all 0.4s ease;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .modal-header h3 {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 800;
        }

        .close-modal {
            background: var(--light);
            border: none;
            font-size: 1.8rem;
            color: var(--gray);
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: var(--light-gray);
            transform: rotate(90deg);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .no-results-icon {
            font-size: 5rem;
            color: var(--light-gray);
            margin-bottom: 30px;
            opacity: 0.5;
        }

        .no-results h3 {
            color: var(--dark);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .no-results p {
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* Email Confirmation */
        .email-confirmation {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin: 40px auto;
            max-width: 500px;
        }

        .email-confirmation i {
            font-size: 4rem;
            color: var(--safe);
            margin-bottom: 20px;
        }

        .email-confirmation h3 {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .email-confirmation p {
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .dashboard-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .dashboard-actions {
                justify-content: center;
            }
            
            .modal-content {
                padding: 25px;
                margin: 10px;
            }
            
            .nutrition-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .allergen-select-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .allergen-grid,
            .restaurant-grid {
                grid-template-columns: 1fr;
            }
            
            .nutrition-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .list-item {
                flex-direction: column;
                text-align: center;
            }
            
            .list-item-actions {
                justify-content: center;
            }
            
            .allergen-select-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <div class="toast-content">
            <h4>Success</h4>
            <p id="toastMessage">Operation completed successfully</p>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo" id="homeLink">
                    <div class="logo-icon">
                        <i class="fas fa-shrimp"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Kati Check</h1>
                        <span class="tagline">Philippine Allergen Checker</span>
                    </div>
                </a>
                <button class="company-login-btn" id="companyLoginBtn">
                    <i class="fas fa-store"></i> Restaurant Login
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- User Interface (Default View) -->
        <div id="userInterface">
            <div class="card">
                <h2 class="section-title">Check for Allergens</h2>
                <p style="color: var(--gray); margin-bottom: 25px; font-size: 1.1rem;">Select your allergens and search restaurant menus across the Philippines</p>

                <!-- Allergen Selection -->
                <div class="allergen-selection-section">
                    <h3 class="section-subtitle" style="font-size: 1.3rem; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-allergies" style="color: var(--primary);"></i> Select Your Allergens
                    </h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">Tap on allergens you want to avoid (International & Philippine Standards)</p>
                    <div class="allergen-grid" id="allergenGrid">
                        <!-- Allergens will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Restaurant Selection -->
                <div class="restaurant-selection-section" style="margin-top: 40px;">
                    <h3 class="section-subtitle" style="font-size: 1.3rem; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-utensils" style="color: var(--primary);"></i> Select Restaurants
                    </h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">Choose specific restaurants to search</p>
                    <div class="restaurant-grid" id="restaurantGrid">
                        <!-- Restaurants will be populated by JavaScript -->
                    </div>
                    <div style="margin-top: 25px; display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="restaurant-item" id="selectAllRestaurants" style="justify-content: center; min-width: 150px;">
                            <i class="fas fa-check-double"></i> Select All
                        </button>
                        <button class="restaurant-item" id="clearAllRestaurants" style="justify-content: center; min-width: 150px;">
                            <i class="fas fa-times-circle"></i> Clear All
                        </button>
                    </div>
                </div>

                <!-- Search Button -->
                <div class="search-button-container">
                    <button class="search-button" id="searchButton">
                        <i class="fas fa-search"></i> Search Menus
                    </button>
                </div>
            </div>

            <!-- Search Results -->
            <div id="searchResultsContainer" class="hidden">
                <div class="card">
                    <div class="results-header">
                        <h3 class="section-title">Search Results</h3>
                        <div class="results-count" id="resultsCount">0 items found</div>
                    </div>
                    <button class="clear-search" id="clearSearch">
                        <i class="fas fa-times"></i> Clear Search
                    </button>
                    <div class="results-container" id="searchResults" style="margin-top: 30px;">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="no-results hidden">
                <div class="no-results-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3>No matching menu items found</h3>
                <p>Try adjusting your allergen selections or restaurant filters</p>
                <button class="auth-button" id="backToSearchFromNoResults" style="max-width: 250px; margin: 0 auto;">
                    <i class="fas fa-arrow-left"></i> Back to Search
                </button>
            </div>
        </div>

        <!-- Company Login/Register -->
        <div id="companyAuth" class="hidden">
            <div class="card" style="max-width: 500px; margin: 0 auto;">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="loginTab">Login</button>
                    <button class="auth-tab" id="registerTab">Register</button>
                </div>

                <!-- Login Form -->
                <div id="loginForm">
                    <h3 class="section-title">Restaurant Login</h3>
                    <form id="companyLoginForm">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope"></i> Company Email
                            </label>
                            <input type="email" class="form-input" id="companyEmail" placeholder="Enter your company email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i> Password
                            </label>
                            <input type="password" class="form-input" id="companyPassword" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="auth-button">
                            <i class="fas fa-sign-in-alt"></i> Login to Dashboard
                        </button>
                    </form>
                    <button class="back-button" id="backToSearchFromLogin">
                        <i class="fas fa-arrow-left"></i> Back to Search
                    </button>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="hidden">
                    <h3 class="section-title">Register Your Restaurant</h3>
                    <form id="companyRegisterForm">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-building"></i> Company Name
                            </label>
                            <input type="text" class="form-input" id="regCompanyName" placeholder="Enter your company name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope"></i> Company Email
                            </label>
                            <input type="email" class="form-input" id="regCompanyEmail" placeholder="Enter your company email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-phone"></i> Phone Number
                            </label>
                            <input type="tel" class="form-input" id="regPhone" placeholder="Enter your phone number" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i> Password
                            </label>
                            <input type="password" class="form-input" id="regPassword" placeholder="Create a password" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock"></i> Confirm Password
                            </label>
                            <input type="password" class="form-input" id="regConfirmPassword" placeholder="Confirm your password" required>
                        </div>
                        <button type="submit" class="auth-button">
                            <i class="fas fa-check-circle"></i> Register Company
                        </button>
                    </form>
                    <button class="back-button" id="backToSearchFromRegister">
                        <i class="fas fa-arrow-left"></i> Back to Search
                    </button>
                </div>
            </div>
        </div>

        <!-- Company Dashboard -->
        <div id="companyDashboard" class="hidden">
            <!-- Dashboard will be loaded by JavaScript -->
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <div class="logo-icon">
                            <i class="fas fa-shrimp"></i>
                        </div>
                        <div class="footer-brand-text">
                            <h3>Kati Check</h3>
                            <p>Philippine Allergen Checker</p>
                        </div>
                    </div>
                    <p style="color: #bbb; font-size: 1rem; line-height: 1.7;">Helping Filipinos with food allergies dine safely across the Philippines.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" id="footerHomeLink"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#" id="footerCompanyLink"><i class="fas fa-store"></i> For Restaurants</a></li>
                        <li><a href="#"><i class="fas fa-info-circle"></i> About Us</a></li>
                        <li><a href="#"><i class="fas fa-question-circle"></i> FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <ul class="footer-links">
                        <li><a href="mailto:info@katicheck.ph"><i class="fas fa-envelope"></i> info@katicheck.ph</a></li>
                        <li><a href="tel:+63212345678"><i class="fas fa-phone"></i> (02) 1234-5678</a></li>
                        <li><a href="#"><i class="fas fa-map-marker-alt"></i> Manila, Philippines</a></li>
                        <li><a href="#"><i class="fas fa-clock"></i> Mon-Fri: 9AM-6PM</a></li>
                    </ul>
                </div>
            </div>
            <div class="powered-by">
                <i class="fas fa-shield-alt"></i> Powered and secured by <strong>Kati Check Team</strong>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div id="editRestaurantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Restaurant</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editRestaurantForm">
                <input type="hidden" id="editRestaurantId">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-store"></i> Restaurant Name</label>
                    <input type="text" class="form-input" id="editRestaurantName" placeholder="Enter restaurant name" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-map-marker-alt"></i> Location</label>
                    <input type="text" class="form-input" id="editRestaurantLocation" placeholder="Enter restaurant location" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-map-pin"></i> GPS Coordinates (Optional)</label>
                    <input type="text" class="form-input" id="editRestaurantGPS" placeholder="e.g., 14.5995, 120.9842">
                    <small style="color: var(--gray); display: block; margin-top: 5px;">Get coordinates from Google Maps</small>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-utensils"></i> Restaurant Type</label>
                    <select class="form-input" id="editRestaurantType" required>
                        <option value="">Select type</option>
                        <option value="Fast Food">Fast Food</option>
                        <option value="Casual Dining">Casual Dining</option>
                        <option value="Fine Dining">Fine Dining</option>
                        <option value="Cafe">Cafe</option>
                        <option value="Food Court">Food Court</option>
                        <option value="Bakery">Bakery</option>
                        <option value="Food Truck">Food Truck</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-align-left"></i> Description (Optional)</label>
                    <textarea class="form-input" id="editRestaurantDescription" placeholder="Enter restaurant description" rows="3"></textarea>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </div>

    <div id="addRestaurantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Restaurant</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addRestaurantForm">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-store"></i> Restaurant Name</label>
                    <input type="text" class="form-input" id="restaurantName" placeholder="Enter restaurant name" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-map-marker-alt"></i> Location</label>
                    <input type="text" class="form-input" id="restaurantLocation" placeholder="Enter restaurant location" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-map-pin"></i> GPS Coordinates (Optional)</label>
                    <input type="text" class="form-input" id="restaurantGPS" placeholder="e.g., 14.5995, 120.9842">
                    <small style="color: var(--gray); display: block; margin-top: 5px;">Get coordinates from Google Maps</small>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-utensils"></i> Restaurant Type</label>
                    <select class="form-input" id="restaurantType" required>
                        <option value="">Select type</option>
                        <option value="Fast Food">Fast Food</option>
                        <option value="Casual Dining">Casual Dining</option>
                        <option value="Fine Dining">Fine Dining</option>
                        <option value="Cafe">Cafe</option>
                        <option value="Food Court">Food Court</option>
                        <option value="Bakery">Bakery</option>
                        <option value="Food Truck">Food Truck</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-align-left"></i> Description (Optional)</label>
                    <textarea class="form-input" id="restaurantDescription" placeholder="Enter restaurant description" rows="3"></textarea>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-plus"></i> Add Restaurant
                </button>
            </form>
        </div>
    </div>

    <div id="addMenuItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Menu Item</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addMenuItemForm">
                <input type="hidden" id="menuRestaurantId">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-utensils"></i> Food Name</label>
                    <input type="text" class="form-input" id="menuItemName" placeholder="Enter food name" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-align-left"></i> Description</label>
                    <textarea class="form-input" id="menuItemDescription" placeholder="Enter food description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-peso-sign"></i> Price (PHP)</label>
                    <input type="number" class="form-input" id="menuItemPrice" placeholder="Enter price in PHP" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-tag"></i> Category</label>
                    <select class="form-input" id="menuItemCategory" required>
                        <option value="">Select category</option>
                        <option value="Appetizer">Appetizer</option>
                        <option value="Main Course">Main Course</option>
                        <option value="Side Dish">Side Dish</option>
                        <option value="Dessert">Dessert</option>
                        <option value="Beverage">Beverage</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Dinner">Dinner</option>
                        <option value="Snack">Snack</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-image"></i> Image URL (Optional)</label>
                    <input type="text" class="form-input" id="menuItemImage" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-allergies"></i> Allergens</label>
                    <div class="allergen-select-grid" id="allergenSelectionGrid">
                        <!-- Allergen checkboxes will be populated by JavaScript -->
                    </div>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-plus"></i> Add Menu Item
                </button>
            </form>
        </div>
    </div>

    <div id="editMenuItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Menu Item</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editMenuItemForm">
                <input type="hidden" id="editMenuItemId">
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-utensils"></i> Food Name</label>
                    <input type="text" class="form-input" id="editMenuItemName" placeholder="Enter food name" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-align-left"></i> Description</label>
                    <textarea class="form-input" id="editMenuItemDescription" placeholder="Enter food description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-peso-sign"></i> Price (PHP)</label>
                    <input type="number" class="form-input" id="editMenuItemPrice" placeholder="Enter price in PHP" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-tag"></i> Category</label>
                    <select class="form-input" id="editMenuItemCategory" required>
                        <option value="">Select category</option>
                        <option value="Appetizer">Appetizer</option>
                        <option value="Main Course">Main Course</option>
                        <option value="Side Dish">Side Dish</option>
                        <option value="Dessert">Dessert</option>
                        <option value="Beverage">Beverage</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Dinner">Dinner</option>
                        <option value="Snack">Snack</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-image"></i> Image URL (Optional)</label>
                    <input type="text" class="form-input" id="editMenuItemImage" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-allergies"></i> Allergens</label>
                    <div class="allergen-select-grid" id="editAllergenSelectionGrid">
                        <!-- Allergen checkboxes will be populated by JavaScript -->
                    </div>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </div>

    <div id="nutritionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nutritional Information</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="nutritionForm">
                <input type="hidden" id="nutritionItemId">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label class="form-label"><i class="fas fa-fire"></i> Calories</label>
                        <input type="number" class="form-input" id="nutritionCalories" placeholder="Calories" min="0" step="1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-dumbbell"></i> Protein (g)</label>
                        <input type="number" class="form-input" id="nutritionProtein" placeholder="Protein" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-bread-slice"></i> Carbs (g)</label>
                        <input type="number" class="form-input" id="nutritionCarbs" placeholder="Carbohydrates" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-candy-cane"></i> Sugar (g)</label>
                        <input type="number" class="form-input" id="nutritionSugar" placeholder="Sugar" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-bacon"></i> Total Fat (g)</label>
                        <input type="number" class="form-input" id="nutritionFat" placeholder="Total Fat" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-bacon"></i> Saturated Fat (g)</label>
                        <input type="number" class="form-input" id="nutritionSaturatedFat" placeholder="Saturated Fat" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-seedling"></i> Dietary Fiber (g)</label>
                        <input type="number" class="form-input" id="nutritionFiber" placeholder="Dietary Fiber" min="0" step="0.1" required>
                    </div>
                    <div>
                        <label class="form-label"><i class="fas fa-prescription-bottle"></i> Sodium (mg)</label>
                        <input type="number" class="form-input" id="nutritionSodium" placeholder="Sodium" min="0" step="1" required>
                    </div>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-save"></i> Save Nutritional Information
                </button>
            </form>
        </div>
    </div>

    <script>
        // Complete Allergen List with International & Philippine Standards
        const allergens = [
            { id: 1, name: "Gluten", icon: "fas fa-wheat", color: "var(--allergen-gluten)" },
            { id: 2, name: "Shrimp", icon: "fas fa-shrimp", color: "var(--allergen-crustacean)" },
            { id: 3, name: "Crab", icon: "fas fa-crab", color: "var(--allergen-crustacean)" },
            { id: 4, name: "Lobster", icon: "fas fa-fish", color: "var(--allergen-crustacean)" },
            { id: 5, name: "Eggs", icon: "fas fa-egg", color: "var(--allergen-egg)" },
            { id: 6, name: "Fish", icon: "fas fa-fish", color: "var(--allergen-fish)" },
            { id: 7, name: "Peanuts", icon: "fas fa-peanut", color: "var(--allergen-peanut)" },
            { id: 8, name: "Soy", icon: "fas fa-seedling", color: "var(--allergen-soy)" },
            { id: 9, name: "Milk", icon: "fas fa-wine-bottle", color: "var(--allergen-milk)" },
            { id: 10, name: "Tree Nuts", icon: "fas fa-acorn", color: "var(--allergen-nuts)" },
            { id: 11, name: "Celery", icon: "fas fa-carrot", color: "var(--allergen-celery)" },
            { id: 12, name: "Mustard", icon: "fas fa-mortar-pestle", color: "var(--allergen-mustard)" },
            { id: 13, name: "Sesame", icon: "fas fa-seedling", color: "var(--allergen-sesame)" },
            { id: 14, name: "Sulfites", icon: "fas fa-flask", color: "var(--allergen-sulfite)" },
            { id: 15, name: "Lupin", icon: "fas fa-leaf", color: "var(--allergen-lupin)" },
            { id: 16, name: "Molluscs", icon: "fas fa-oyster", color: "var(--allergen-mollusc)" },
            { id: 17, name: "Crustaceans", icon: "fas fa-shrimp", color: "var(--allergen-crustacean)" },
            { id: 18, name: "Shellfish", icon: "fas fa-shrimp", color: "var(--allergen-crustacean)" },
            { id: 19, name: "Wheat", icon: "fas fa-bread-slice", color: "var(--allergen-gluten)" },
            { id: 20, name: "Barley", icon: "fas fa-seedling", color: "var(--allergen-gluten)" },
            { id: 21, name: "Rye", icon: "fas fa-seedling", color: "var(--allergen-gluten)" },
            { id: 22, name: "Oats", icon: "fas fa-seedling", color: "var(--allergen-gluten)" },
            { id: 23, name: "MSG", icon: "fas fa-flask", color: "var(--allergen-sulfite)" },
            { id: 24, name: "Peanut Oil", icon: "fas fa-oil-can", color: "var(--allergen-peanut)" },
            { id: 25, name: "Soybean", icon: "fas fa-seedling", color: "var(--allergen-soy)" }
        ];

        // REAL PHILIPPINE RESTAURANT DATA WITH ALLERGEN INFO
        const initialRestaurants = [
            {
                id: 1,
                name: "Chowking",
                type: "Fast Food",
                location: "Nationwide (Philippines)",
                description: "Chinese-Filipino fast food chain offering dimsum, noodles, and rice meals",
                gps: "14.5995, 120.9842",
                hasAllergenInfo: true,
                companyId: 1,
                allergensAvailable: true
            },
            {
                id: 2,
                name: "Jollibee",
                type: "Fast Food",
                location: "Nationwide (Philippines)",
                description: "Philippines' largest fast food chain serving Filipino-style fried chicken, burgers, and spaghetti",
                gps: "14.6042, 120.9822",
                hasAllergenInfo: true,
                companyId: 2,
                allergensAvailable: true
            },
            {
                id: 3,
                name: "The Wholesome Table",
                type: "Casual Dining",
                location: "Makati, BGC, Rockwell",
                description: "Organic restaurant with allergen-marked menu and gluten-free options",
                gps: "14.5547, 121.0244",
                hasAllergenInfo: true,
                companyId: 3,
                allergensAvailable: true
            },
            {
                id: 4,
                name: "Corner Tree Cafe",
                type: "Cafe",
                location: "Jupiter, Makati",
                description: "Vegetarian restaurant with allergen-marked menu including Filipino dishes",
                gps: "14.5578, 121.0164",
                hasAllergenInfo: true,
                companyId: 4,
                allergensAvailable: true
            },
            {
                id: 5,
                name: "Purple Patch",
                type: "Casual Dining",
                location: "Washington, D.C. (USA)",
                description: "Filipino restaurant that is completely nut and seed-free",
                gps: "38.9215, -77.0423",
                hasAllergenInfo: true,
                companyId: 5,
                allergensAvailable: true
            },
            {
                id: 6,
                name: "Top of Cebu",
                type: "Fine Dining",
                location: "Cebu City, Philippines",
                description: "Restaurant on mountain top with chef knowledgeable about food allergies",
                gps: "10.3157, 123.8854",
                hasAllergenInfo: true,
                companyId: 6,
                allergensAvailable: true
            },
            {
                id: 7,
                name: "Mang Inasal",
                type: "Fast Food",
                location: "Nationwide (Philippines)",
                description: "Grilled chicken fast food chain, generally safe for gluten-free diets",
                gps: "14.6091, 121.0223",
                hasAllergenInfo: false,
                companyId: 7,
                allergensAvailable: false
            },
            {
                id: 8,
                name: "Bacolod Chicken Inasal",
                type: "Fast Food",
                location: "Nationwide (Philippines)",
                description: "Specializes in grilled chicken with vinegar-oil marinade (gluten-free)",
                gps: "14.5542, 121.0241",
                hasAllergenInfo: false,
                companyId: 8,
                allergensAvailable: false
            }
        ];

        // REAL MENU ITEMS WITH ALLERGEN DATA ONLY (NO NUTRITION)
        const initialMenuItems = [
            // Chowking Menu Items
            {
                id: 1,
                restaurantId: 1,
                name: "Pork Siomai",
                description: "Steamed pork dumplings served with soy sauce",
                price: 85.00,
                category: "Dimsum",
                allergens: [1, 5, 8, 9, 14] // Gluten, Egg, Soy, Milk, Sulfites
            },
            {
                id: 2,
                restaurantId: 1,
                name: "Beef Chao Fan",
                description: "Chinese-style fried rice with beef and vegetables",
                price: 145.00,
                category: "Main Course",
                allergens: [1, 5, 8, 11] // Gluten, Egg, Soy, Celery
            },
            {
                id: 3,
                restaurantId: 1,
                name: "Halo-Halo Supreme",
                description: "Traditional Filipino shaved ice dessert with fruits, beans, and leche flan",
                price: 125.00,
                category: "Dessert",
                allergens: [1, 5, 9, 13] // Gluten, Egg, Milk, Sesame
            },
            {
                id: 4,
                restaurantId: 1,
                name: "Sweet & Sour Pork",
                description: "Crispy pork in sweet and sour sauce with vegetables",
                price: 165.00,
                category: "Main Course",
                allergens: [1, 8, 14] // Gluten, Soy, Sulfites
            },
            {
                id: 5,
                restaurantId: 1,
                name: "Pancit Canton",
                description: "Stir-fried noodles with vegetables and meat",
                price: 135.00,
                category: "Noodles",
                allergens: [1, 5, 8, 11] // Gluten, Egg, Soy, Celery
            },
            // Jollibee Menu Items
            {
                id: 6,
                restaurantId: 2,
                name: "Chickenjoy (1pc)",
                description: "Classic Filipino-style crispy fried chicken",
                price: 99.00,
                category: "Main Course",
                allergens: [1, 5, 9] // Gluten, Egg, Milk
            },
            {
                id: 7,
                restaurantId: 2,
                name: "Jolly Spaghetti",
                description: "Sweet-style spaghetti with hotdog and cheese",
                price: 85.00,
                category: "Main Course",
                allergens: [1, 5, 9] // Gluten, Egg, Milk
            },
            {
                id: 8,
                restaurantId: 2,
                name: "Peach Mango Pie",
                description: "Fried pie with peach and mango filling",
                price: 45.00,
                category: "Dessert",
                allergens: [1] // Gluten only
            },
            {
                id: 9,
                restaurantId: 2,
                name: "Burger Steak",
                description: "Beef patty with mushroom gravy and rice",
                price: 75.00,
                category: "Main Course",
                allergens: [1, 5, 8, 9] // Gluten, Egg, Soy, Milk
            },
            // The Wholesome Table (gluten-free options)
            {
                id: 10,
                restaurantId: 3,
                name: "Gluten-Free Pancit",
                description: "Rice noodles stir-fried with vegetables and choice of protein",
                price: 395.00,
                category: "Main Course",
                allergens: [8] // Soy only (from sauce)
            },
            {
                id: 11,
                restaurantId: 3,
                name: "Organic Chicken Adobo",
                description: "Traditional Filipino chicken stew made gluten-free",
                price: 425.00,
                category: "Main Course",
                allergens: [8] // Soy only (from coconut aminos)
            },
            // Purple Patch (nut-free restaurant)
            {
                id: 12,
                restaurantId: 5,
                name: "Nut-Free Kare-Kare",
                description: "Traditional Filipino oxtail stew made without peanuts",
                price: 550.00,
                category: "Main Course",
                allergens: [1, 2, 5, 8, 9] // Gluten, Shrimp, Egg, Soy, Milk
            },
            // Mang Inasal
            {
                id: 13,
                restaurantId: 7,
                name: "Chicken Inasal",
                description: "Grilled chicken marinated in vinegar, calamansi, and spices",
                price: 125.00,
                category: "Main Course",
                allergens: [] // Generally gluten-free based on marinade
            },
            // Bacolod Chicken Inasal
            {
                id: 14,
                restaurantId: 8,
                name: "Grilled Chicken Inasal",
                description: "Special grilled chicken with vinegar-oil marinade",
                price: 145.00,
                category: "Main Course",
                allergens: [] // Gluten-free marinade
            }
        ];

        // Application Data - Updated with real data
        let restaurants = initialRestaurants;
        let menuItems = initialMenuItems;
        let companies = [
            {
                id: 1,
                name: "Jollibee Foods Corporation",
                email: "corporate@jollibee.com.ph",
                phone: "+632-888-7000",
                password: "demo123",
                restaurants: [2]
            },
            {
                id: 2,
                name: "Chowking Food Corporation",
                email: "info@chowking.ph",
                phone: "+632-898-2000",
                password: "demo123",
                restaurants: [1]
            },
            {
                id: 3,
                name: "The Wholesome Table",
                email: "contact@wholesometable.ph",
                phone: "+632-884-9999",
                password: "demo123",
                restaurants: [3]
            }
        ];

        // Application State
        let currentCompany = null;
        let selectedAllergens = new Set();
        let selectedRestaurants = new Set();

        // DOM Elements
        const userInterface = document.getElementById('userInterface');
        const companyAuth = document.getElementById('companyAuth');
        const companyDashboard = document.getElementById('companyDashboard');
        const allergenGrid = document.getElementById('allergenGrid');
        const restaurantGrid = document.getElementById('restaurantGrid');
        const searchButton = document.getElementById('searchButton');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const searchResults = document.getElementById('searchResults');
        const resultsCount = document.getElementById('resultsCount');
        const noResults = document.getElementById('noResults');
        const clearSearch = document.getElementById('clearSearch');
        const backToSearchFromNoResults = document.getElementById('backToSearchFromNoResults');
        const companyLoginBtn = document.getElementById('companyLoginBtn');
        const homeLink = document.getElementById('homeLink');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const companyLoginForm = document.getElementById('companyLoginForm');
        const companyRegisterForm = document.getElementById('companyRegisterForm');
        const backToSearchFromLogin = document.getElementById('backToSearchFromLogin');
        const backToSearchFromRegister = document.getElementById('backToSearchFromRegister');
        const footerHomeLink = document.getElementById('footerHomeLink');
        const footerCompanyLink = document.getElementById('footerCompanyLink');
        const selectAllRestaurants = document.getElementById('selectAllRestaurants');
        const clearAllRestaurants = document.getElementById('clearAllRestaurants');
        const addRestaurantModal = document.getElementById('addRestaurantModal');
        const editRestaurantModal = document.getElementById('editRestaurantModal');
        const addMenuItemModal = document.getElementById('addMenuItemModal');
        const editMenuItemModal = document.getElementById('editMenuItemModal');
        const nutritionModal = document.getElementById('nutritionModal');
        const toast = document.getElementById('toast');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const addRestaurantForm = document.getElementById('addRestaurantForm');
        const editRestaurantForm = document.getElementById('editRestaurantForm');
        const addMenuItemForm = document.getElementById('addMenuItemForm');
        const editMenuItemForm = document.getElementById('editMenuItemForm');
        const nutritionForm = document.getElementById('nutritionForm');

        // Initialize Application
        function initApp() {
            // Load saved data from localStorage
            loadSavedData();
            
            // Populate allergens
            populateAllergens();
            populateAllergenSelectionGrid();
            populateEditAllergenSelectionGrid();

            // Populate restaurants
            populateRestaurants();

            // Set up event listeners
            setupEventListeners();
            
            // Show demo restaurant info
            showDemoInfo();
        }

        // Show demo information
        function showDemoInfo() {
            console.log("Kati Check Demo - Philippine Restaurant Allergen Checker");
            console.log("Loaded with real data from:");
            console.log("- Chowking (actual allergen declaration)");
            console.log("- Jollibee (allergen info)");
            console.log("- Philippine restaurants with allergen awareness");
        }

        // Load saved data from localStorage
        function loadSavedData() {
            // Load companies
            const savedCompanies = localStorage.getItem('katiCheckCompanies');
            if (savedCompanies) {
                try {
                    companies = JSON.parse(savedCompanies);
                } catch (e) {
                    console.error('Error loading companies:', e);
                    companies = initialRestaurants;
                }
            }

            // Load restaurants
            const savedRestaurants = localStorage.getItem('katiCheckRestaurants');
            if (savedRestaurants) {
                try {
                    restaurants = JSON.parse(savedRestaurants);
                } catch (e) {
                    console.error('Error loading restaurants:', e);
                    restaurants = initialRestaurants;
                }
            }

            // Load menu items
            const savedMenuItems = localStorage.getItem('katiCheckMenuItems');
            if (savedMenuItems) {
                try {
                    menuItems = JSON.parse(savedMenuItems);
                } catch (e) {
                    console.error('Error loading menu items:', e);
                    menuItems = initialMenuItems;
                }
            }

            // Load current company
            const savedCompany = localStorage.getItem('katiCheckCompany');
            if (savedCompany) {
                try {
                    currentCompany = JSON.parse(savedCompany);
                    showCompanyDashboard();
                } catch (e) {
                    console.error('Error loading saved company:', e);
                    localStorage.removeItem('katiCheckCompany');
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('katiCheckCompanies', JSON.stringify(companies));
            localStorage.setItem('katiCheckRestaurants', JSON.stringify(restaurants));
            localStorage.setItem('katiCheckMenuItems', JSON.stringify(menuItems));
            if (currentCompany) {
                localStorage.setItem('katiCheckCompany', JSON.stringify(currentCompany));
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            
            switch(type) {
                case 'success':
                    toastIcon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    toastIcon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    toastIcon.className = 'fas fa-exclamation-triangle';
                    break;
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Populate allergens grid
        function populateAllergens() {
            allergenGrid.innerHTML = '';
            allergens.forEach(allergen => {
                const allergenItem = document.createElement('div');
                allergenItem.className = 'allergen-item';
                allergenItem.dataset.id = allergen.id;
                allergenItem.dataset.name = allergen.name;
                allergenItem.innerHTML = `
                    <div class="allergen-icon" style="color: ${allergen.color};">
                        <i class="${allergen.icon}"></i>
                    </div>
                    <div class="allergen-name">${allergen.name}</div>
                `;
                allergenGrid.appendChild(allergenItem);

                // Add click event
                allergenItem.addEventListener('click', () => {
                    toggleAllergenSelection(allergen.id, allergenItem);
                });
            });
        }

        // Populate allergen selection grid for menu item form
        function populateAllergenSelectionGrid() {
            const grid = document.getElementById('allergenSelectionGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            allergens.forEach(allergen => {
                const item = document.createElement('div');
                item.className = 'allergen-select-item';
                item.dataset.id = allergen.id;
                item.innerHTML = `
                    <div class="allergen-select-icon" style="color: ${allergen.color};">
                        <i class="${allergen.icon}"></i>
                    </div>
                    <div class="allergen-select-name">${allergen.name}</div>
                `;
                
                item.addEventListener('click', () => {
                    item.classList.toggle('selected');
                });
                
                grid.appendChild(item);
            });
        }

        // Populate edit allergen selection grid
        function populateEditAllergenSelectionGrid() {
            const grid = document.getElementById('editAllergenSelectionGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            allergens.forEach(allergen => {
                const item = document.createElement('div');
                item.className = 'allergen-select-item';
                item.dataset.id = allergen.id;
                item.innerHTML = `
                    <div class="allergen-select-icon" style="color: ${allergen.color};">
                        <i class="${allergen.icon}"></i>
                    </div>
                    <div class="allergen-select-name">${allergen.name}</div>
                `;
                
                item.addEventListener('click', () => {
                    item.classList.toggle('selected');
                });
                
                grid.appendChild(item);
            });
        }

        // Get selected allergens from grid
        function getSelectedAllergensFromGrid(gridId) {
            const grid = document.getElementById(gridId);
            if (!grid) return [];
            
            const selectedItems = grid.querySelectorAll('.allergen-select-item.selected');
            return Array.from(selectedItems).map(item => parseInt(item.dataset.id));
        }

        // Set selected allergens in grid
        function setSelectedAllergensInGrid(gridId, allergenIds) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            
            const items = grid.querySelectorAll('.allergen-select-item');
            items.forEach(item => {
                const id = parseInt(item.dataset.id);
                if (allergenIds.includes(id)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }

        // Populate restaurants grid
        function populateRestaurants() {
            restaurantGrid.innerHTML = '';
            restaurants.forEach(restaurant => {
                const restaurantItem = document.createElement('div');
                restaurantItem.className = 'restaurant-item';
                restaurantItem.dataset.id = restaurant.id;
                
                // Add info badge for restaurants with allergen data
                const infoBadge = restaurant.hasAllergenInfo ? 
                    '<span style="position: absolute; top: 5px; right: 5px; background: var(--primary); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem;"><i class="fas fa-check"></i></span>' : '';
                
                restaurantItem.innerHTML = `
                    <div class="restaurant-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="restaurant-name">${restaurant.name}</div>
                    ${infoBadge}
                `;
                restaurantGrid.appendChild(restaurantItem);

                // Add click event
                restaurantItem.addEventListener('click', () => {
                    toggleRestaurantSelection(restaurant.id, restaurantItem);
                });
                
                // Add tooltip for restaurants with allergen info
                if (restaurant.hasAllergenInfo) {
                    restaurantItem.title = "This restaurant has publicly available allergen information";
                }
            });
        }

        // Toggle allergen selection
        function toggleAllergenSelection(allergenId, element) {
            if (selectedAllergens.has(allergenId)) {
                selectedAllergens.delete(allergenId);
                element.classList.remove('selected');
            } else {
                selectedAllergens.add(allergenId);
                element.classList.add('selected');
            }
        }

        // Toggle restaurant selection
        function toggleRestaurantSelection(restaurantId, element) {
            if (selectedRestaurants.has(restaurantId)) {
                selectedRestaurants.delete(restaurantId);
                element.classList.remove('selected');
            } else {
                selectedRestaurants.add(restaurantId);
                element.classList.add('selected');
            }
        }

        // Perform search - SIMPLIFIED VERSION (NO NUTRITION FILTERS)
        function performSearch() {
            console.log("=== DEBUG: Starting Search ===");
            console.log("Selected Allergens:", Array.from(selectedAllergens));
            console.log("Selected Restaurants:", Array.from(selectedRestaurants));
            console.log("Total Menu Items:", menuItems.length);
            
            if (selectedAllergens.size === 0) {
                showToast('Please select at least one allergen to search for.', 'warning');
                return;
            }

            if (selectedRestaurants.size === 0) {
                showToast('Please select at least one restaurant to search in.', 'warning');
                return;
            }

            userInterface.style.display = 'none';
            searchResultsContainer.classList.remove('hidden');
            searchResults.innerHTML = '<div class="spinner"></div>';

            // Simulate API call delay
            setTimeout(() => {
                const filteredItems = menuItems.filter(item => {
                    // Filter by restaurant
                    if (!selectedRestaurants.has(item.restaurantId)) {
                        console.log(` ${item.name} excluded: Not in selected restaurant`);
                        return false;
                    }
                    
                    // Filter by allergens - Show items that DON'T contain selected allergens
                    const hasSelectedAllergen = item.allergens && item.allergens.some(allergenId => 
                        selectedAllergens.has(allergenId)
                    );
                    
                    // If item has ANY of the selected allergens, exclude it
                    if (hasSelectedAllergen) {
                        console.log(` ${item.name} excluded: Contains selected allergens`);
                        return false;
                    }
                    
                    console.log(` ${item.name} included: Safe item`);
                    return true; // Item is safe (doesn't contain selected allergens)
                });

                console.log("Filtered Items Found:", filteredItems.length);
                displaySearchResults(filteredItems);
            }, 500);
        }

        // Display search results - SIMPLIFIED VERSION (NO NUTRITION DATA)
        function displaySearchResults(items) {
            searchResults.innerHTML = '';
            
            if (items.length === 0) {
                searchResultsContainer.classList.add('hidden');
                noResults.classList.remove('hidden');
                return;
            }

            resultsCount.textContent = `${items.length} item${items.length !== 1 ? 's' : ''} found`;
            
            items.forEach(item => {
                const restaurant = restaurants.find(r => r.id === item.restaurantId);
                const otherAllergens = item.allergens ? item.allergens.filter(id => !selectedAllergens.has(id)) : [];
                
                // Determine safety level
                let safetyClass = 'safe';
                let safetyText = 'Safe';
                
                // Check if item has other allergens not selected by user
                if (otherAllergens.length > 0) {
                    safetyClass = 'may-contain';
                    safetyText = 'May contain other allergens';
                }

                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${safetyClass}`;

                resultItem.innerHTML = `
                    <div class="result-header">
                        <div>
                            <div class="food-name">${item.name} <span style="color: var(--primary); font-size: 1.3rem;">${item.price.toFixed(2)}</span></div>
                            <div class="restaurant-info">
                                <i class="fas fa-store"></i>
                                <span>${restaurant?.name || 'Unknown'}  ${restaurant?.location || 'Unknown'}</span>
                                <span style="background: var(--light); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                                    <i class="fas fa-tag"></i> ${item.category}
                                </span>
                            </div>
                        </div>
                        <div style="background: ${safetyClass === 'safe' ? 'var(--safe)' : safetyClass === 'warning' ? 'var(--warning)' : 'var(--danger)'}; color: white; padding: 10px 20px; border-radius: 25px; font-size: 0.9rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;">
                            ${safetyText}
                        </div>
                    </div>
                    <div class="food-description">${item.description}</div>
                    ${otherAllergens.length > 0 ? `
                        <div class="allergen-tags">
                            <strong style="font-size: 1rem; color: var(--dark); margin-bottom: 10px; display: block;"> Contains Other Allergens:</strong>
                            ${otherAllergens.map(id => {
                                const allergen = allergens.find(a => a.id === id);
                                return `<span class="allergen-tag may-contain"><i class="${allergen?.icon || 'fas fa-exclamation-triangle'}" style="color: ${allergen?.color || 'var(--warning)'};"></i> ${allergen?.name || 'Unknown Allergen'}</span>`;
                            }).join('')}
                        </div>
                    ` : `
                        <div class="allergen-tags">
                            <span class="allergen-tag safe"><i class="fas fa-check-circle"></i> No allergens detected</span>
                        </div>
                    `}
                `;

                searchResults.appendChild(resultItem);
            });
        }

        // Clear search
        function clearSearchResults() {
            selectedAllergens.clear();
            selectedRestaurants.clear();
            
            // Reset UI
            document.querySelectorAll('.allergen-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            document.querySelectorAll('.restaurant-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            searchResultsContainer.classList.add('hidden');
            noResults.classList.add('hidden');
            userInterface.style.display = 'block';
        }

        // Show company authentication
        function showCompanyAuth() {
            userInterface.style.display = 'none';
            companyAuth.classList.remove('hidden');
            companyDashboard.classList.add('hidden');
        }

        // Show user interface
        function showUserInterface() {
            userInterface.style.display = 'block';
            companyAuth.classList.add('hidden');
            companyDashboard.classList.add('hidden');
        }

        // Show company dashboard
        function showCompanyDashboard() {
            if (!currentCompany) {
                showCompanyAuth();
                return;
            }
            
            userInterface.style.display = 'none';
            companyAuth.classList.add('hidden');
            companyDashboard.classList.remove('hidden');
            loadCompanyDashboard();
        }

        // Load company dashboard - UPDATED (REMOVED NUTRITION STATS)
        function loadCompanyDashboard() {
            if (!currentCompany) return;

            const companyRestaurants = restaurants.filter(r => r.companyId === currentCompany.id);
            const companyMenuItems = menuItems.filter(item => 
                companyRestaurants.some(r => r.id === item.restaurantId)
            );

            companyDashboard.innerHTML = `
                <div class="dashboard-header">
                    <div class="company-info">
                        <h2>${currentCompany.name}</h2>
                        <p><i class="fas fa-envelope"></i> ${currentCompany.email} | <i class="fas fa-phone"></i> ${currentCompany.phone}</p>
                    </div>
                    <div class="dashboard-actions">
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="stat-number">${companyRestaurants.length}</div>
                        <div class="stat-label">Restaurants</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-number">${companyMenuItems.length}</div>
                        <div class="stat-label">Menu Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-allergies"></i>
                        </div>
                        <div class="stat-number">${companyRestaurants.filter(r => r.hasAllergenInfo).length}</div>
                        <div class="stat-label">Allergen Info</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-number">${companyMenuItems.filter(item => item.allergens.length > 0).length}</div>
                        <div class="stat-label">Items with Allergens</div>
                    </div>
                </div>

                <div class="dashboard-section">
                    <div class="dashboard-section-title">
                        <span><i class="fas fa-store"></i> Your Restaurants</span>
                        <button class="add-button" id="addRestaurantBtn">
                            <i class="fas fa-plus"></i> Add Restaurant
                        </button>
                    </div>
                    <div class="dashboard-list" id="companyRestaurantsList">
                        ${companyRestaurants.length > 0 ? 
                            companyRestaurants.map(restaurant => {
                                const restaurantMenu = menuItems.filter(item => item.restaurantId === restaurant.id);
                                return `
                                    <div class="list-item">
                                        <div class="list-item-info">
                                            <h4>${restaurant.name}</h4>
                                            <p>
                                                <span><i class="fas fa-utensils"></i> ${restaurant.type}</span>
                                                <span><i class="fas fa-map-marker-alt"></i> ${restaurant.location}</span>
                                                <span><i class="fas fa-utensils"></i> ${restaurantMenu.length} menu items</span>
                                                ${restaurant.hasAllergenInfo ? '<span style="color: var(--safe);"><i class="fas fa-check"></i> Allergen Info</span>' : '<span style="color: var(--warning);"><i class="fas fa-exclamation"></i> Needs Allergen Info</span>'}
                                            </p>
                                            ${restaurant.description ? `<p style="color: var(--gray); font-size: 0.95rem; margin-top: 10px;">${restaurant.description}</p>` : ''}
                                        </div>
                                        <div class="list-item-actions">
                                            <button class="action-btn view-btn" onclick="viewRestaurantMenu(${restaurant.id})" title="View Menu">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" onclick="editRestaurant(${restaurant.id})" title="Edit Restaurant">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete-btn" onclick="deleteRestaurant(${restaurant.id})" title="Delete Restaurant">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('') : 
                            '<div style="text-align: center; padding: 40px; color: var(--gray);"><p>No restaurants added yet. Add your first restaurant!</p></div>'
                        }
                    </div>
                </div>

                <div class="dashboard-section">
                    <div class="dashboard-section-title">
                        <span><i class="fas fa-utensils"></i> All Menu Items</span>
                        <button class="add-button" id="addMenuItemBtn">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                    <div class="dashboard-list" id="companyMenuItemsList">
                        ${companyMenuItems.length > 0 ? 
                            companyMenuItems.map(item => {
                                const restaurant = restaurants.find(r => r.id === item.restaurantId);
                                const hasAllergens = item.allergens.length > 0 ? 
                                    '<span style="color: var(--warning);"><i class="fas fa-exclamation"></i> ' + item.allergens.length + ' allergens</span>' : 
                                    '<span style="color: var(--safe);"><i class="fas fa-check"></i> Allergen-free</span>';
                                return `
                                    <div class="list-item">
                                        <div class="list-item-info">
                                            <h4>${item.name} <span style="color: var(--primary); font-size: 1rem;">${item.price.toFixed(2)}</span></h4>
                                            <p>
                                                <span><i class="fas fa-store"></i> ${restaurant?.name || 'Unknown'}</span>
                                                <span><i class="fas fa-tag"></i> ${item.category}</span>
                                                ${hasAllergens}
                                            </p>
                                        </div>
                                        <div class="list-item-actions">
                                            <button class="action-btn edit-btn" onclick="editMenuItem(${item.id})" title="Edit Menu Item">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete-btn" onclick="deleteMenuItem(${item.id})" title="Delete Menu Item">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('') : 
                            '<div style="text-align: center; padding: 40px; color: var(--gray);"><p>No menu items added yet. Add your first item!</p></div>'
                        }
                    </div>
                </div>
            `;

            // Add event listeners for dashboard buttons
            document.getElementById('addRestaurantBtn')?.addEventListener('click', () => {
                addRestaurantModal.classList.add('active');
            });

            document.getElementById('addMenuItemBtn')?.addEventListener('click', () => {
                // Get company restaurants for dropdown
                const companyRestaurants = restaurants.filter(r => r.companyId === currentCompany.id);
                const restaurantSelect = document.createElement('select');
                restaurantSelect.className = 'form-input';
                restaurantSelect.id = 'menuRestaurantSelect';
                restaurantSelect.innerHTML = '<option value="">Select Restaurant</option>' + 
                    companyRestaurants.map(r => `<option value="${r.id}">${r.name}</option>`).join('');
                
                // Replace hidden input with select
                const hiddenInput = document.getElementById('menuRestaurantId');
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                formGroup.innerHTML = `
                    <label class="form-label"><i class="fas fa-store"></i> Restaurant</label>
                `;
                formGroup.appendChild(restaurantSelect);
                
                // Insert at beginning of form
                const form = document.getElementById('addMenuItemForm');
                form.insertBefore(formGroup, form.firstChild);
                
                addMenuItemModal.classList.add('active');
            });

            document.getElementById('logoutBtn')?.addEventListener('click', logout);
        }

        // View restaurant menu
        window.viewRestaurantMenu = function(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId);
            const restaurantMenu = menuItems.filter(item => item.restaurantId === restaurantId);
            
            let menuText = `Menu for ${restaurant.name}:\n\n`;
            restaurantMenu.forEach(item => {
                menuText += ` ${item.name} - ${item.price.toFixed(2)}\n`;
                menuText += `  ${item.description}\n`;
                if (item.allergens.length > 0) {
                    const allergenNames = item.allergens.map(id => {
                        const allergen = allergens.find(a => a.id === id);
                        return allergen ? allergen.name : 'Unknown';
                    });
                    menuText += `  Allergens: ${allergenNames.join(', ')}\n`;
                } else {
                    menuText += `  Allergens: None detected\n`;
                }
                menuText += '\n';
            });
            
            alert(menuText);
        };

        // Edit restaurant
        window.editRestaurant = function(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            document.getElementById('editRestaurantId').value = restaurant.id;
            document.getElementById('editRestaurantName').value = restaurant.name;
            document.getElementById('editRestaurantLocation').value = restaurant.location;
            document.getElementById('editRestaurantGPS').value = restaurant.gps || '';
            document.getElementById('editRestaurantType').value = restaurant.type;
            document.getElementById('editRestaurantDescription').value = restaurant.description || '';
            
            editRestaurantModal.classList.add('active');
        };

        // Delete restaurant
        window.deleteRestaurant = function(restaurantId) {
            if (confirm('Are you sure you want to delete this restaurant? This will also delete all associated menu items.')) {
                restaurants = restaurants.filter(r => r.id !== restaurantId);
                menuItems = menuItems.filter(item => item.restaurantId !== restaurantId);
                
                if (currentCompany) {
                    // Update company restaurants list
                    const companyIndex = companies.findIndex(c => c.id === currentCompany.id);
                    if (companyIndex !== -1) {
                        companies[companyIndex].restaurants = companies[companyIndex].restaurants.filter(id => id !== restaurantId);
                    }
                }
                
                saveData();
                populateRestaurants();
                loadCompanyDashboard();
                showToast('Restaurant deleted successfully.', 'success');
            }
        };

        // Edit menu item
        window.editMenuItem = function(itemId) {
            const item = menuItems.find(m => m.id === itemId);
            if (!item) return;
            
            document.getElementById('editMenuItemId').value = item.id;
            document.getElementById('editMenuItemName').value = item.name;
            document.getElementById('editMenuItemDescription').value = item.description;
            document.getElementById('editMenuItemPrice').value = item.price;
            document.getElementById('editMenuItemCategory').value = item.category;
            document.getElementById('editMenuItemImage').value = item.image || '';
            
            // Set selected allergens
            setSelectedAllergensInGrid('editAllergenSelectionGrid', item.allergens);
            
            editMenuItemModal.classList.add('active');
        };

        // Open nutrition modal - KEEPING BUT DISABLED
        window.openNutritionModal = function(itemId) {
            showToast('Nutrition feature is currently disabled. This is an allergen-only version.', 'warning');
        };

        // Delete menu item
        window.deleteMenuItem = function(itemId) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                menuItems = menuItems.filter(item => item.id !== itemId);
                saveData();
                loadCompanyDashboard();
                showToast('Menu item deleted successfully.', 'success');
            }
        };

        // Handle company login
        function handleCompanyLogin(e) {
            e.preventDefault();
            
            const companyEmail = document.getElementById('companyEmail').value;
            const password = document.getElementById('companyPassword').value;
            
            const company = companies.find(c => c.email === companyEmail && c.password === password);
            
            if (company) {
                currentCompany = company;
                localStorage.setItem('katiCheckCompany', JSON.stringify(company));
                showToast('Login successful!', 'success');
                setTimeout(() => {
                    showCompanyDashboard();
                }, 1000);
            } else {
                showToast('Invalid email or password. Please try again.', 'error');
            }
        }

        // Handle company registration
        async function handleCompanyRegister(e) {
            e.preventDefault();
            
            const companyName = document.getElementById('regCompanyName').value;
            const companyEmail = document.getElementById('regCompanyEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match.', 'error');
                return;
            }
            
            const existingCompany = companies.find(c => c.email === companyEmail);
            if (existingCompany) {
                showToast('A company with this email already exists.', 'error');
                return;
            }
            
            const newCompany = {
                id: companies.length > 0 ? Math.max(...companies.map(c => c.id)) + 1 : 1,
                name: companyName,
                email: companyEmail,
                phone: phone,
                password: password,
                restaurants: []
            };
            
            companies.push(newCompany);
            currentCompany = newCompany;
            saveData();
            
            showToast('Registration successful!', 'success');
            setTimeout(() => {
                showCompanyDashboard();
            }, 1500);
        }

        // Handle add restaurant
        function handleAddRestaurant(e) {
            e.preventDefault();
            
            if (!currentCompany) {
                showToast('Please login first', 'error');
                return;
            }
            
            const restaurantName = document.getElementById('restaurantName').value;
            const restaurantLocation = document.getElementById('restaurantLocation').value;
            const restaurantGPS = document.getElementById('restaurantGPS').value;
            const restaurantType = document.getElementById('restaurantType').value;
            const restaurantDescription = document.getElementById('restaurantDescription').value;
            
            const newRestaurant = {
                id: restaurants.length > 0 ? Math.max(...restaurants.map(r => r.id)) + 1 : 1,
                name: restaurantName,
                companyId: currentCompany.id,
                type: restaurantType,
                location: restaurantLocation,
                gps: restaurantGPS,
                description: restaurantDescription,
                hasAllergenInfo: false,
                allergensAvailable: false
            };
            
            restaurants.push(newRestaurant);
            currentCompany.restaurants.push(newRestaurant.id);
            
            saveData();
            
            // Update user interface restaurant list
            populateRestaurants();
            
            // Reset and close modal
            addRestaurantModal.classList.remove('active');
            addRestaurantForm.reset();
            
            // Reload dashboard
            loadCompanyDashboard();
            
            showToast('Restaurant added successfully!', 'success');
        }

        // Handle edit restaurant
        function handleEditRestaurant(e) {
            e.preventDefault();
            
            const restaurantId = parseInt(document.getElementById('editRestaurantId').value);
            const restaurantIndex = restaurants.findIndex(r => r.id === restaurantId);
            
            if (restaurantIndex === -1) {
                showToast('Restaurant not found', 'error');
                return;
            }
            
            restaurants[restaurantIndex] = {
                ...restaurants[restaurantIndex],
                name: document.getElementById('editRestaurantName').value,
                location: document.getElementById('editRestaurantLocation').value,
                gps: document.getElementById('editRestaurantGPS').value,
                type: document.getElementById('editRestaurantType').value,
                description: document.getElementById('editRestaurantDescription').value
            };
            
            saveData();
            
            editRestaurantModal.classList.remove('active');
            populateRestaurants();
            loadCompanyDashboard();
            
            showToast('Restaurant updated successfully!', 'success');
        }

        // Handle add menu item
        function handleAddMenuItem(e) {
            e.preventDefault();
            
            const restaurantSelect = document.getElementById('menuRestaurantSelect');
            if (!restaurantSelect) {
                showToast('Please select a restaurant', 'error');
                return;
            }
            
            const restaurantId = parseInt(restaurantSelect.value);
            if (!restaurantId) {
                showToast('Please select a restaurant first', 'error');
                return;
            }
            
            const selectedAllergenIds = getSelectedAllergensFromGrid('allergenSelectionGrid');
            
            const menuItemData = {
                id: menuItems.length > 0 ? Math.max(...menuItems.map(m => m.id)) + 1 : 1,
                restaurantId: restaurantId,
                name: document.getElementById('menuItemName').value,
                description: document.getElementById('menuItemDescription').value,
                price: parseFloat(document.getElementById('menuItemPrice').value),
                category: document.getElementById('menuItemCategory').value,
                image: document.getElementById('menuItemImage').value || '',
                allergens: selectedAllergenIds
            };
            
            menuItems.push(menuItemData);
            saveData();
            
            addMenuItemModal.classList.remove('active');
            loadCompanyDashboard();
            
            showToast('Menu item added successfully!', 'success');
        }

        // Handle edit menu item
        function handleEditMenuItem(e) {
            e.preventDefault();
            
            const itemId = parseInt(document.getElementById('editMenuItemId').value);
            const itemIndex = menuItems.findIndex(m => m.id === itemId);
            
            if (itemIndex === -1) {
                showToast('Menu item not found', 'error');
                return;
            }
            
            const selectedAllergenIds = getSelectedAllergensFromGrid('editAllergenSelectionGrid');
            
            menuItems[itemIndex] = {
                ...menuItems[itemIndex],
                name: document.getElementById('editMenuItemName').value,
                description: document.getElementById('editMenuItemDescription').value,
                price: parseFloat(document.getElementById('editMenuItemPrice').value),
                category: document.getElementById('editMenuItemCategory').value,
                image: document.getElementById('editMenuItemImage').value || '',
                allergens: selectedAllergenIds
            };
            
            saveData();
            
            editMenuItemModal.classList.remove('active');
            loadCompanyDashboard();
            
            showToast('Menu item updated successfully!', 'success');
        }

        // Handle nutrition form - DISABLED
        function handleNutritionForm(e) {
            e.preventDefault();
            showToast('Nutrition feature is currently disabled. This is an allergen-only version.', 'warning');
            nutritionModal.classList.remove('active');
        }

        // Logout
        function logout() {
            currentCompany = null;
            localStorage.removeItem('katiCheckCompany');
            showToast('Logged out successfully', 'success');
            setTimeout(() => {
                showUserInterface();
            }, 1000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search button
            searchButton.addEventListener('click', performSearch);
            
            // Clear search
            clearSearch.addEventListener('click', clearSearchResults);
            backToSearchFromNoResults.addEventListener('click', clearSearchResults);
            
            // Navigation
            companyLoginBtn.addEventListener('click', showCompanyAuth);
            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showUserInterface();
            });
            
            // Auth tabs
            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            });
            
            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            });
            
            // Back to search buttons
            backToSearchFromLogin.addEventListener('click', showUserInterface);
            backToSearchFromRegister.addEventListener('click', showUserInterface);
            
            // Footer links
            footerHomeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showUserInterface();
            });
            
            footerCompanyLink.addEventListener('click', (e) => {
                e.preventDefault();
                showCompanyAuth();
            });
            
            // Restaurant selection buttons
            selectAllRestaurants.addEventListener('click', () => {
                selectedRestaurants = new Set(restaurants.map(r => r.id));
                document.querySelectorAll('.restaurant-item').forEach(item => {
                    item.classList.add('selected');
                });
                showToast('All restaurants selected', 'success');
            });
            
            clearAllRestaurants.addEventListener('click', () => {
                selectedRestaurants.clear();
                document.querySelectorAll('.restaurant-item').forEach(item => {
                    item.classList.remove('selected');
                });
                showToast('All restaurants cleared', 'success');
            });
            
            // Forms
            companyLoginForm.addEventListener('submit', handleCompanyLogin);
            companyRegisterForm.addEventListener('submit', handleCompanyRegister);
            addRestaurantForm.addEventListener('submit', handleAddRestaurant);
            editRestaurantForm.addEventListener('submit', handleEditRestaurant);
            addMenuItemForm.addEventListener('submit', handleAddMenuItem);
            editMenuItemForm.addEventListener('submit', handleEditMenuItem);
            nutritionForm.addEventListener('submit', handleNutritionForm);
            
            // Modals
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('active');
                    });
                    // Reset forms when closing
                    document.querySelectorAll('form').forEach(form => {
                        if (form.id !== 'companyLoginForm' && form.id !== 'companyRegisterForm') {
                            form.reset();
                        }
                    });
                });
            });
            
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                    // Reset forms when closing
                    document.querySelectorAll('form').forEach(form => {
                        if (form.id !== 'companyLoginForm' && form.id !== 'companyRegisterForm') {
                            form.reset();
                        }
                    });
                }
            });
            
            // Prevent form submission on enter
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                }
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
